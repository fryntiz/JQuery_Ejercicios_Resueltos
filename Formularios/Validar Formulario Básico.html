<!DOCTYPE html>
<!--
 @author Raúl Caro Pastorino
 @copyright Copyright © 2017 Raúl Caro Pastorino
 @license https://wwww.gnu.org/licenses/gpl.txt
-->

<!--
↓ INSTRUCCIONES DEL EJERCICIO ↓
Valida los campos según el patrón indicado en el atributo placeholder

Si no cumple las condiciones, dibujar el recuadro en color rojo y mostrar junto a este en un bloque <span> el formato correcto.

Si cumple las condiciones mostrar el fondo del <input> en color verde.

No dejará enviar el formulario mientras no se hayan introducido todos los campos correctamente.
-->
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Validar Formulario Básico</title>
    <style>
        label {display: block;}
        span {color: red;}
    </style>
    <script src="./jquery-3.2.1.js"></script>
    <script>
    window.onload = function() {

        /**
         * Muestra el error junto al bloque correspondiente
         * @param  {Elemento} elemento Elemento al que aplicar error
         */
        function mostrarError(elemento) {
            var formato = elemento.attr('placeholder');
            // Crear nodo <span></span>

            // Enganchar nodo con el mensaje de placeholder
        }

        /**
         * Recibe un patrón y un elemento input para comprobar si es válido
         * @param  {RegExp} patron   Expresión regular que debe cumplir
         * @param  {Elemento} elemento Elemento al que aplicar error
         */
        function validar(patron, elemento) {
            if (patron.test(elemento.val())) {
                elemento.css('background-color', '#00ff00');
            } else {
                elemento.css('background-color', '#ff0000');
                mostrarError(elemento);
            }
        }

        // Añadir evento a inputs cuando pierde foco
        $('input[type="text"]').focusout(function() {
            switch($(this).attr('name')) {
                case 'nombre':
                    validar(new RegExp('^[A-Z]{1}[a-z]{3}$','g'), $(this));
                    break;
                case 'tel':
                    validar(new RegExp('^[0-9]{3}[\-]{1}[0-9]{6}$','g'), $(this));
                    break;
                case 'cp':
                    validar(new RegExp('^[1-9]{1}[0-9]{4}$','g'), $(this));
                    break;
                case 'email':
                    validar(new RegExp('^[a-z]+[@]{1}[a-z]+[\.]{1}[a-z]{2,3}$','g'), $(this));
                    break;
            }
        });
    }
    </script>
</head>

<body>
    <h1>Formulario de Contacto</h1>
    <form name="formulario" id="f">
        <label> Nombre:
            <input type="text" name="nombre" placeholder="Xxxx" />
        </label>
        <label>Teléfono:
            <input type="text" name="tel" placeholder="XXX-XXXXXX"/>
        </label>
        <label> Código postal:
            <input type="text" name="cp" placeholder="XXXXX"  />
        </label>
        <label> Email:
            <input type="text" name="email" placeholder="xxx@xxxx.xx"/>
        </label>
        <input type="submit" name="enviar" value="Enviar"/>
    </form>
</body>
</html>
