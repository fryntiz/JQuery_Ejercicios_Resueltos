<!DOCTYPE html>
<!--
 @author Raúl Caro Pastorino
 @copyright Copyright © 2017 Raúl Caro Pastorino
 @license https://wwww.gnu.org/licenses/gpl.txt
-->

<!--
↓ INSTRUCCIONES DEL EJERCICIO ↓

-->
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Listas desplegables de Provincias y Municipios</title>
    <script src="jquery-3.2.1.js"></script>
    <script type="text/javascript">
        // Provincia elegida
        var prov;

        // Municipio elegido
        var mun;

        function ordenar() {
            $('select').each(function (index, elem) {
                // Guardamos la opción seleccionada
                var sel = elem.selectedIndex;

                // Aplicacion del orden alfabetico
                $(elem).html($("option", $(this)).sort(function (a, b) {
                    return a.text == b.text ? 0 : a.text < b.text ? -1 : 1 //ordena por texto
                    //return a.value == b.value ? 0 : a.value < b.value ? -1 : 1 //ordena por atributo value
                }));

                // Reestablecemos la opción seleccionada previamente
                $(elem).prop('selectedIndex', sel); //listaActual.selectedIndex = sel;

            });
        }

        function rellenarProvincia() {
            $.getJSON('../Servidor/cargaProvinciasJSON.php', function (data) {
                $.each(data, function (codigo, nombre) {
                    $('#provincia').append('<option value="' + codigo + '">' +
                        nombre + '</option>');
                });
            });

            //ordenar(prov);
        }

        function rellenarMunicipio() {
            $.getJSON('../Servidor/cargaMunicipiosJSON.php',
                {'provincia' : prov}, function
                (data) {
                $.each(data, function (codigo, nombre) {
                    $('#municipio').append('<option value="' + codigo + '">' +
                        nombre + '</option>');
                });
            });

            //ordenar(mun);
        }

        window.onload = function () {
            rellenarProvincia();
            $('#municipio').on('click', rellenarMunicipio);

            $('#provincia').on('change', function(){
                prov = $(this).children('option:selected').val();
            });
        }
    </script>
</head>

<body>
    <h1>Listas desplegables de Provincias y Municipios</h1>
    <form>
        <label for="provincia">Provincia</label>
        <select id="provincia">
            <option>-Seleccionar-</option>
        </select>

        <br /><br />

        <label for="municipio">Municipio</label>
        <select id="municipio">
            <option>-Seleccionar Provincia-</option>
        </select>
    </form>
</body>
</html>
